<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.board.mapper.BoardMapper">
    <select id="selectBoardList" resultType="com.example.board.dto.BoardDto">
        select board_idx, title, hit_cnt, date_format(created_dt, '%Y.%m.%d %H:%i:%s') as created_dt
        from t_board
        where deleted_yn = 'N'
        order by board_idx desc
    </select>

    <!-- 외부 입력값을 쿼리에 반영할 경우, #{ }을 이용해야 SQL 인젝션 공격을 방어할 수 있음 -->
    <insert id="insertBoard" parameterType="com.example.board.dto.BoardDto">
        insert into t_board(title, contents, created_dt, created_id)
        values (#{title}, #{contents}, now(), #{createdId})
    </insert>

    <update id="updateHitCnt" parameterType="int">
        update t_board
        set hit_cnt = hit_cnt + 1
        where board_idx = #{boardIdx}
    </update>

    <select id="selectBoardDetail" parameterType="int" resultType="com.example.board.dto.BoardDto">
        select board_idx,
               title,
               hit_cnt,
               date_format(created_dt, '%Y.%m.%d %H:%i:%s') as created_dt,
               contents,
               created_id
        from t_board
        where deleted_yn = 'N'
          and board_idx = #{boardIdx}
    </select>

    <update id="updateBoard" parameterType="com.example.board.dto.BoardDto">
        update t_board
        set title      = #{title},
            contents   = #{contents},
            updater_dt = now(),
            updater_id = #{updaterId}
        where board_idx = #{boardIdx}
    </update>

    <delete id="deleteBoard" parameterType="com.example.board.dto.BoardDto">
        update t_board
        set deleted_yn = 'Y'
          , updater_dt = now()
          , updater_id = #{updaterId}
        where board_idx = #{boardIdx}
    </delete>
</mapper>